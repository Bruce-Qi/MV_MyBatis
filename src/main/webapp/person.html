<table id="roles_dataInfo"></table>

<div id="admin_search">
	<a href="javascript:addAdminInfo()" class="easyui-linkbutton"
		data-options="iconCls:'icon-add',plain:true" style="float: left">添加</a>
	<div class="datagrid-btn-separator"></div>

	
	<div class="datagrid-btn-separator"></div>
	<label>请选择角色：</label><select name="role" id="admin_select_rid">
		<option value="-1">--请选择--</option>
	</select>&nbsp; <label>请输入管理员姓名：</label><input type="text" name="aname"
		id="admin_select_aname" /> <label>请选择状态：</label><select name="status"
		id="admin_select_status">
		<option value='-1'>--请选择--</option>
		<option value='0'>未审核</option>
		<option value='1'>未通过审核</option>
		<option value='2'>已审核</option>
		<option value='3'>冻结</option>
	</select> &nbsp;&nbsp;<a href="javascript:search_adminInfo()"
		class="easyui-linkbutton" data-options="iconCls:'icon-search'">查找</a>
</div>


<!-- 添加操作框 -->
<div   id="admin_addAdminInfo" class="easyui-dialog" title="添加管理员信息"
	data-options="iconCls:'icon-add',resizable:true,modal:true,fit:true,closed:true ">


	<div class="admin_left">
		<center>
			<form>
				<ul>
					<li><span>电影名称:</span> <input type="text" name="mv_name"
						id="mv_name" placeholder="请输入电影名称" required="required" /></li>
					<li><span>电影类型 : </span> <select
						name="mv_type" id="mv_type">
					</select></li>
					
					<li><span>主演: </span> <input
						type="text" name="mv_actor" id="mv_actor"
						placeholder="请输入主演" required="required" /></li>
					<li><span>导演 : </span> <input type="text"
						name="mv_director" id="mv_director" placeholder="请输入导演名称"
						required="required" /></li>
					<li><span>价格:</span> <input type="text" name="mv_ticketPrice"
						id="mv_ticketPrice" placeholder="请输入价格" required="required" /></li>
				</ul>
			</form>

			<br /> <br /> <a href="javascript:add_adminInfo()"
				class="easyui-linkbutton" data-options="iconCls:'icon-add'">添加</a>
		</center>
	</div>
	
	
	<!-- 右键菜单 -->
	<div id="mm" class="easyui-menu" style="width:120px;"> 
		<div onclick="$('#grantRoleWindow').window('open');">修改信息</div>
	</div>
	
	<div class="easyui-window" title="修改信息" id="grantRoleWindow" closed="true" collapsible="false" minimizable="false" maximizable="false" style="top:100px;left:700px;width:400px;height:300px">
		<div region="north" style="height:31px;overflow:hidden;" split="false" border="false" >
			<div class="datagrid-toolbar">
				<a id="save" icon="icon-save"  class="easyui-linkbutton" plain="true" >保存</a>
			</div>
		</div>
	<div region="center" style="overflow:auto;padding:5px;" border="false">
			<form id="grantForm"  >
				<ul>
					<li><span>电影编号:</span> <input type="text" name="mv_fileID"
						id="mv_fileID" placeholder="电影编号" readonly="readonly" /></li>	
					<li><span>电影名称:</span> <input type="text" name="mv_name"
						id="mv_name" placeholder="请输入电影名称" required="required" /></li>
					<li><span>电影类型 : </span> 
					<select
						name="mv_type1" id="mv_type1">
					</select></li>
					
					<li><span>主演: </span> <input
						type="text" name="mv_actor" id="mv_actor"
						placeholder="请输入主演" required="required" /></li>
					<li><span>导演 : </span> <input type="text"
						name="mv_director" id="mv_director" placeholder="请输入导演名称"
						required="required" /></li>
					<li><span>价格:</span> <input type="text" name="mv_ticketPrice"
						id="mv_ticketPrice" placeholder="请输入价格" required="required" /></li>
				</ul>
			</form>
		</div>
	</div>
	
	
<script>

	var datagrid;
	var editRow = undefined; 
	var op;
	var flag;
	var typename;

	datagrid = $('#roles_dataInfo').datagrid({
		url : 'servlet/PersonServlet',
		queryParams : {
			op : "findAll"
		},
		loadMsg : "数据加载中",
		fitColumns : true,
		striped : true,
		nowrap : true,
		fit : true,
		rownumbers : true,
		sortName : "fileID",
		remoteSort : false,
		columns : [ [ {
			field : 'fileIDs',
			title : '选择',
			width : 10,
			align : 'center',
			checkbox : true
		},{
			field : 'fileID',
			title : '电影编号',
			width : 60,
			align : 'center',
			sortable : true
		}, {
			field : 'filemName',
			title : '电影名称',
			width : 60,
			align : 'center',
			editor : {
				type : "text",
				options : {
					required : true
				}
			}
		},  {
			field : 'filmType',
			title : '类型',
			width : 100,
			align : 'center',
  			editor : {
				type : "combobox",
				options : {
					required : true,
				}
			}, 
			formatter:function(value,row,index){
				typename=value.typeName;
				return value.typeName;
			}
		}, {
			field : 'actor',
			title : '主演',
			width : 60,
			align : 'center',
			editor : {
				type : "text"
			}
		}, {
			field : 'director',
			title : '导演',
			width : 100,
			align : 'center',
			editor : {
				type : "text"
			}
		},{
				field : 'ticketPrice',
				title : '票价',
				width : 100,
				align : 'center', 
				editor : {
					type : "text"
				}
			},{
				field : '_operate',
				title : '操作',
				width : 100,
				align : 'center',
				formatter : function(val, row, index) {
					return " &nbsp;&nbsp;<a href='javascript:delteAdminInfo("+row.fileid+")' class='icon-remove1  icon-padding' >删除</a>";
				}
			}
			
		] ],
		toolbar : "#admin_search",
		onRowContextMenu:function(e,rowIndex,rowData){
			e.preventDefault();  //阻止默认事件
			//弹出自定义菜单
			$('#mm').menu('show',{
				left:e.pageX,
				top: e.pageY
			});
			// 将右键点击数据行，记录form 中
			$('#mv_fileID').val(rowData.fileID);
			$('#mv_name').val(rowData.filemName);
			$('#mv_actor').val(rowData.actor);
			$('#mv_director').val(rowData.director);
			$('#mv_type1').val(rowData.typeName);
			$('#mv_ticketPrice').val(rowData.ticketPrice);
		}
			
	});
</script>

<script>
//删除一行
function  delteAdminInfo(id){
	if(id!=null){
		 $.post("servlet/PersonServlet",{op:"deltePerson",id:id},function(data){
				data=parseInt($.trim(data));

				if(data>0){
					$.messager.show({title:'温馨提示',msg:'删除成功',timeout:2000,showType:'slide'});
					$('#roles_dataInfo').datagrid("reload");
				}else{
					$.messager.alert('失败','删除失败','error');   
				}
			}); 
	}
}

$(function(){
	$.post("servlet/PersonServlet",{op:"findfilmType"},function(data){
		 var obj=$("#mv_type");
		 var obj1=$("#mv_type1");
		 $.each(data,function(index,item){
				obj.append($("<option value='"+item.typeID+"'>"+item.typeName+"</option>"));
				obj1.append($("<option value='"+item.typeID+"'>"+item.typeName+"</option>"));
			});
	 },"json");
});


function addAdminInfo() {
	//查询电影类型
	$("#admin_addAdminInfo").dialog("open");
}


//添加管理员信息
function add_adminInfo(){
	var filemName=$("#mv_name").val();
	var typeID=$("#mv_type").val();
	var actor=$("#mv_actor").val();
	var director=$("#mv_director").val();
	var ticketPrice=$("#mv_ticketPrice").val();
	
	
		$.post("servlet/PersonServlet",{op:"addMVInfo",filemName:filemName,typeID:typeID,actor:actor,director:director,ticketPrice:ticketPrice},function(data){
			data=parseInt($.trim(data));
			
			if(data>0){
				$.messager.show({title:'温馨提示',msg:'添加成功',timeout:2000,showType:'slide'});
				
				$("#mv_name").val("");
				$("#mv_actor").val("");
				$("#mv_director").val("");
				$("#mv_ticketPrice").val("");
				
				$("#admin_addAdminInfo").dialog("close");
				$('#roles_dataInfo').datagrid("reload");
				
				
			}else{
				$.messager.alert('失败','添加失败','error');   
			}
			
		});

}


// 为授予角色 保存按钮添加 点击事件
$('#save').click(function(){
	if($('#grantForm').form('validate')){
		$('#grantForm').submit();
	}
});



//弹出更新操作框
function updateAdminInfo(row){
	$("#admin_updateAdminInfo").dialog("open");
	
	$("#update_admin_aid").val(row.aid);
	$("#update_admin_aname").val(row.aname);
	$("#update_admin_role").val(row.rid);
	$("#update_admin_pwd").val(row.pwd);
	$("#update_admin_email").val(row.email);
	$("#update_admin_tel").val(row.tel);
	
	if(row.photo!=""){
		$("#update_adminInfo_photo").attr("src","../../"+row.photo);
	}else{
		$("#update_adminInfo_photo").attr("src","../../images/zanwu.jpg");
	}

}


//更新数据
function  update_adminInfo(){
	var aid=$("#update_admin_aid").val();
	var rid=$("#update_admin_role").val();
	var aname=$("#update_admin_aname").val();
	var pwd=$("#update_admin_pwd").val();
	var email=$("#update_admin_email").val();
	var tel=$("#update_admin_tel").val();
	
	
	if(pwd.length>16){
		pwd=pwd;
	}else{
		pwd=hex_md5(pwd);
	}
		
	
	$.ajaxFileUpload({
		url:"../../servlet/adminInfoServlet?op=updateAdminInfo",
		secureuri:false,
		fileElementId:"update_admin_photo",
		dataType:"json",
		data:{rid:rid,aname:aname,pwd:pwd,email:email,tel:tel,aid:aid},
		success:function(data,status){
			data=parseInt($.trim(data));
			
			if(data>0){
				$.messager.show({title:'温馨提示',msg:'修改成功',timeout:2000,showType:'slide'});
				
				$("#admin_updateAdminInfo").dialog("close");
				$('#admin_dataInfo').datagrid("reload");
			}
		},
		error:function(data,status,e){
			$.messager.alert('失败','修改失败','error');   
		}
	});
	
}





</script>



